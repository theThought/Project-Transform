<meta name="robots" content="noindex, nofollow">

<link rel="stylesheet" href="styles/formal/base.css" type="text/css" />

<!-- Scripts required for survey components. -->
<script src="scripts/require.js" type="text/javascript"></script>
<script src="scripts/survey.js" type="text/javascript"></script>
<script src="scripts/base.js" type="text/javascript"></script>
<script type="text/javascript">
    require.config({
        baseUrl: 'scripts',
        waitSeconds: 0
    });
    require(['main'], function () { });
</script>

<!--
    Some stories contain inline scripts that define survey "custom properties". These will trigger JS to re-write the server-rendered DOM:

    <script>app.RegisterProperties(...)</script>

    When "custom property" story controls are updated, we need to reload story iframe to re-initialise the JS again, based on updated DOM.
 -->
 <script>
    document.addEventListener('DOMContentLoaded', (e) => {
        let targetNode = e.target.querySelector('#scripts-root');
        const config = { childList: true, subtree: true };

        if (!targetNode) return;

        const callback = (mutations) => {
            mutations.forEach(mutation => {
                console.log('mutation...');
                // WIP...
                // 1. Need to re-initialise JS somehow?
                // 2. Reloading iframe does NOT work - e.g. pre/post labels, date input, are not rendered correctly.
            });
        };

        const observer = new MutationObserver(callback);
        targetNode && observer.observe(targetNode, config);
    });
</script>
